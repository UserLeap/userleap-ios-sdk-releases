(function(){"use strict";var kn=Object.defineProperty;var _n=(O,M,j)=>M in O?kn(O,M,{enumerable:!0,configurable:!0,writable:!0,value:j}):O[M]=j;var S=(O,M,j)=>(_n(O,typeof M!="symbol"?M+"":M,j),j);let O;const M=new Uint8Array(16);function j(){if(!O&&(O=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!O))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return O(M)}const L=[];for(let e=0;e<256;++e)L.push((e+256).toString(16).slice(1));function Jt(e,t=0){return L[e[t+0]]+L[e[t+1]]+L[e[t+2]]+L[e[t+3]]+"-"+L[e[t+4]]+L[e[t+5]]+"-"+L[e[t+6]]+L[e[t+7]]+"-"+L[e[t+8]]+L[e[t+9]]+"-"+L[e[t+10]]+L[e[t+11]]+L[e[t+12]]+L[e[t+13]]+L[e[t+14]]+L[e[t+15]]}const Ye={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Le(e,t,r){if(Ye.randomUUID&&!t&&!e)return Ye.randomUUID();e=e||{};const i=e.random||(e.rng||j)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,Jt(i)}const Qt='.ul-loading-spinner-container{font-size:1.8rem;flex-grow:1;width:100%;height:100%;display:flex;align-items:center;justify-content:center}.ul-loading-spinner{display:inline-block;position:relative;width:6rem;height:6rem}.ul-loading-spinner div{box-sizing:border-box;display:block;position:absolute;width:80%;height:80%;margin:5px;border:5px solid #152e3e;border-radius:50%;animation:lds-ring 1.2s cubic-bezier(.5,0,.5,1) infinite;border-color:#152e3e transparent transparent transparent}.ul-loading-spinner .first{animation-delay:-.45s}.ul-loading-spinner .second{animation-delay:-.3s}.ul-loading-spinner .third{animation-delay:-.15s}@keyframes lds-ring{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.fade-in-transition{animation:fadeIn .4s ease-in}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}#sprig-feedback-button{border-left:0;border-radius:0 8px 8px 0;display:grid;padding:8px;text-align:center;transition:all ease-in-out 1s;z-index:inherit}#sprig-feedback-button:hover{cursor:pointer}.sprig-feedback-button-label{writing-mode:vertical-lr;text-orientation:sideways}.sprig-feedback-button-right{transform:rotate(180deg)}.sprig-feedback-button-bottom{align-self:flex-end;margin-bottom:20px}.sprig-feedback-button-light{background:#efefee;color:#000;border:1px solid #e2e3e1}.sprig-feedback-button-dark{background:#000;color:#fff;border:1px solid #000000}#sprig-feedback-container{display:flex;align-items:center;position:fixed;transition:right .2s linear,left .2s linear;z-index:2147483646}.sprig-feedback-container-left{flex-flow:row-reverse}.sprig-feedback-container-center{top:50%;transform:translateY(-50%)}.sprig-feedback-container-bottom{bottom:0%;margin-bottom:15px}.sprig-feedback-loading-container{align-items:center;background-color:#fff;border:2px solid var(--feedback-border);display:flex;max-height:90vh;max-width:90vw;min-width:0px}.sprig-feedback-loading-container-left{border-left:none;border-radius:0 8px 8px 0}.sprig-feedback-loading-container-right{border-right:none;border-radius:8px 0 0 8px}#sprig-feedback-error-container{margin:auto;text-align:center;width:360px}.sprig-feedback-error-text{font-weight:400;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol}#sprig-feedback-loading-container .ul-container{position:relative;max-height:inherit}#sprig-feedback-loading-animation{position:absolute}.sprig-feedback-loading-container-previews iframe{max-height:inherit!important}',Xt="360px",Zt=500;var F=(e=>(e.Closed="close.click",e.Complete="survey.completed",e.FeedbackClosed="feedback.closed",e.PageChange="page.change",e.API="api",e.Override="override",e))(F||{}),p=(e=>(e.ReplayCapture="replay.capture",e.FeedbackButtonLoaded="feedback.button.loaded",e.SDKReady="sdk.ready",e.SurveyAppeared="survey.appeared",e.SurveyClosed="survey.closed",e.SurveyDimensions="survey.dimensions",e.SurveyFadingOut="survey.fadingOut",e.SurveyHeight="survey.height",e.SurveyPresented="survey.presented",e.SurveyLifeCycle="survey.lifeCycle",e.SurveyWidth="survey.width",e.SurveyWillClose="survey.willClose",e.SurveyWillPresent="survey.will.present",e.CloseSurveyOnOverlayClick="close.survey.overlayClick",e.VisitorIDUpdated="visitor.id.updated",e.QuestionAnswered="question.answered",e))(p||{});const ne={FEEDBACK_BUTTON_LOADED:"feedback.button.loaded",SDK_READY:"sdk.ready",SURVEY_APPEARED:"survey.appeared",SURVEY_CLOSED:"survey.closed",SURVEY_DIMENSIONS:"survey.dimensions",SURVEY_FADING_OUT:"survey.fadingOut",SURVEY_HEIGHT:"survey.height",SURVEY_WIDTH:"survey.width",SURVEY_PRESENTED:"survey.presented",SURVEY_LIFE_CYCLE:"survey.lifeCycle",SURVEY_WILL_CLOSE:"survey.willClose",SURVEY_WILL_PRESENT:"survey.will.present",QUESTION_ANSWERED:"question.answered",REPLAY_CAPTURE:"replay.capture",CLOSE_SURVEY_ON_OVERLAY_CLICK:"close.survey.overlayClick",VISITOR_ID_UPDATED:"visitor.id.updated",DATA:{DISMISS_REASONS:{API:"api",CLOSED:"close.click",COMPLETE:"survey.completed",PAGE_CHANGE:"page.change",OVERRIDE:"override"},SURVEY_ID:"survey.id"}},er=300;class tr{constructor(){S(this,"breadcrumbs",[])}getTimeStamp(){return new Date().toISOString()}addBreadcrumb(t){this.breadcrumbs.push(t),this.breadcrumbs.length>er&&this.breadcrumbs.shift()}debug(t,r="debug"){this.addBreadcrumb({category:r,level:"info",message:t,timestamp:this.getTimeStamp(),type:"debug"})}error(t,r={}){this.addBreadcrumb({category:"error",data:r,level:"error",message:t,timestamp:this.getTimeStamp(),type:"error"})}http(t,r){this.addBreadcrumb({category:"xhr",data:r,message:t,timestamp:this.getTimeStamp(),type:"http"})}info(t,r={}){this.addBreadcrumb({category:"info",data:r,level:"info",message:t,timestamp:this.getTimeStamp(),type:"info"})}navigation(t,r){this.addBreadcrumb({category:"navigation",data:r,message:t,timestamp:this.getTimeStamp(),type:"navigation"})}}const U=new tr,Je=()=>{try{return window.parent.Intercom}catch{return null}},Qe=[Object.freeze(Object.defineProperty({__proto__:null,disable:()=>{const e=Je();e&&(e.ul_wasVisible=!!document.querySelector("iframe.intercom-launcher-frame"),e.ul_wasVisible&&e("update",{hide_default_launcher:!0}))},enable:()=>{const e=Je();e&&(e.ul_wasVisible&&e("update",{hide_default_launcher:!1}),delete e.ul_wasVisible)}},Symbol.toStringTag,{value:"Module"}))];class rr{static disable(){Qe.forEach(t=>t.disable())}static enable(){Qe.forEach(t=>t.enable())}}var nr=class extends Error{constructor(e,t,r){super(`Possible EventEmitter memory leak detected. ${r} ${t.toString()} listeners added. Use emitter.setMaxListeners() to increase limit`),this.emitter=e,this.type=t,this.count=r,this.name="MaxListenersExceededWarning"}},Xe=class{static listenerCount(e,t){return e.listenerCount(t)}constructor(){this.events=new Map,this.maxListeners=Xe.defaultMaxListeners,this.hasWarnedAboutPotentialMemoryLeak=!1}_emitInternalEvent(e,t,r){this.emit(e,t,r)}_getListeners(e){return Array.prototype.concat.apply([],this.events.get(e))||[]}_removeListener(e,t){const r=e.indexOf(t);return r>-1&&e.splice(r,1),[]}_wrapOnceListener(e,t){const r=(...i)=>(this.removeListener(e,r),t.apply(this,i));return Object.defineProperty(r,"name",{value:t.name}),r}setMaxListeners(e){return this.maxListeners=e,this}getMaxListeners(){return this.maxListeners}eventNames(){return Array.from(this.events.keys())}emit(e,...t){const r=this._getListeners(e);return r.forEach(i=>{i.apply(this,t)}),r.length>0}addListener(e,t){this._emitInternalEvent("newListener",e,t);const r=this._getListeners(e).concat(t);if(this.events.set(e,r),this.maxListeners>0&&this.listenerCount(e)>this.maxListeners&&!this.hasWarnedAboutPotentialMemoryLeak){this.hasWarnedAboutPotentialMemoryLeak=!0;const i=new nr(this,e,this.listenerCount(e));console.warn(i)}return this}on(e,t){return this.addListener(e,t)}once(e,t){return this.addListener(e,this._wrapOnceListener(e,t))}prependListener(e,t){const r=this._getListeners(e);if(r.length>0){const i=[t].concat(r);this.events.set(e,i)}else this.events.set(e,r.concat(t));return this}prependOnceListener(e,t){return this.prependListener(e,this._wrapOnceListener(e,t))}removeListener(e,t){const r=this._getListeners(e);return r.length>0&&(this._removeListener(r,t),this.events.set(e,r),this._emitInternalEvent("removeListener",e,t)),this}off(e,t){return this.removeListener(e,t)}removeAllListeners(e){return e?this.events.delete(e):this.events.clear(),this}listeners(e){return Array.from(this._getListeners(e))}listenerCount(e){return this._getListeners(e).length}rawListeners(e){return this.listeners(e)}},Ze=Xe;Ze.defaultMaxListeners=10;const w=new Ze,ie=async e=>{await new Promise(t=>{setTimeout(t,e)})},ir=({"userleap-platform":e})=>e!=="web";class et{constructor(t){S(this,"storage");S(this,"tempStorage",{});S(this,"isStorageAvailable");this.storage=window[t],this.isStorageAvailable=this.checkIfStorageAvailable()}checkIfStorageAvailable(){try{const t="__storage_test__";return this.storage.setItem(t,t),this.storage.removeItem(t),!0}catch{return!1}}setItem(t,r){this.isStorageAvailable?this.storage.setItem(t,r):this.tempStorage[t]=r}setItemObject(t,r){try{this.setItem(t,JSON.stringify(r))}catch(i){i instanceof Error&&(i.stack=t+": "+r,window.UserLeap.reportError("Failed to save to local storage",i))}}getItem(t){return this.isStorageAvailable?this.storage.getItem(t):this.tempStorage[t]}getItemObject(t){const r=this.getItem(t);if(r)try{return JSON.parse(r)}catch(i){i instanceof Error&&(i.stack=t+": "+r,window.UserLeap.reportError("Failed to parse local storage",i))}return{}}removeItem(t){this.isStorageAvailable?this.storage.removeItem(t):delete this.tempStorage[t]}clear(){this.isStorageAvailable?this.storage.clear():this.tempStorage={}}}const se=new et("sessionStorage"),I=new et("localStorage");class sr{constructor(t){S(this,"payload");S(this,"promise");S(this,"reject",()=>{});S(this,"resolve",()=>{});this.payload=t,this.promise=new Promise((r,i)=>{this.reject=i,this.resolve=r})}resolveRequest(t){this.resolve(t)}}const Se={replay:null},or=()=>[].join(","),ar={RATELIMIT_RESET_DEFAULT:10};let tt=!1,rt="",oe=!1,nt=!1,ae=[];const dr=e=>e._config&&e._config.installationMethod?e._config.installationMethod:e._gtm?"web-gtm":e._segment?"web-segment":"web-snippet",it=e=>{var t;(t=e==null?void 0:e.blockedURI)!=null&&t.includes(window.UserLeap._API_URL)&&(nt=!0,console.warn(`[Sprig] ${e.blockedURI} is blocked by Content-Security-Policy`))},Ue=(e="")=>{tt=!0,rt=e};function N(e={}){const t={"Content-Type":"application/json","userleap-platform":"web","x-ul-sdk-version":"2.32.2","x-ul-installation-method":dr(e),"sprig-modules":or()};if(e.envId&&(t["x-ul-environment-id"]=e.envId),e.token&&(t.Authorization="Bearer "+e.token),e.userId&&(t["x-ul-user-id"]=e.userId),e.visitorId&&(t["x-ul-visitor-id"]=e.visitorId),e.partnerAnonymousId&&(t["x-ul-anonymous-id"]=e.partnerAnonymousId),e.mobileHeadersJSON){const r=JSON.parse(e.mobileHeadersJSON);Object.assign(t,r)}return e.locale&&(t["accept-language"]=e.locale),window.previewMode&&(t["x-ul-preview-mode"]="1"),t}const st=async({shouldDropOnRateLimit:e,...t})=>{if(e)return{status:429};{const r=new sr(t);return ae.push(r),r.promise}},Y=async(e,t)=>{const{retries:r=0,shouldDropOnRateLimit:i=!1,shouldRetryRequest:n=!1,...s}=t,o={url:e,options:s,retries:r,shouldDropOnRateLimit:i};if(oe&&!n)return st(o);const a={ok:!1,reportError:!1};if(tt)return console.info(`UserLeap - ${rt}`),a;try{const d=await fetch(e,s);if(d.status===429)if(!oe&&!i||n){oe=!0;const c=d.headers.has("ratelimit-reset")?Number(d.headers.get("ratelimit-reset")):ar.RATELIMIT_RESET_DEFAULT;return await ie(c*1e3),Y(e,{...s,shouldDropOnRateLimit:i,shouldRetryRequest:!0})}else return st(o);if(oe=!1,ae.length&&(ae.map(l=>{const c=l.payload;Y(c.url,{...c.options,retries:c.retries,shouldDropOnRateLimit:c.shouldDropOnRateLimit}).then(u=>{l.resolveRequest(u)})}),ae=[]),d.ok){if(d.status===249)return Ue(),a;const l=await d.text();try{return l&&l!=="OK"&&(d.json=JSON.parse(l)),d}catch{return{ok:!1,reportError:!1,error:new Error(`failed parsing response json for ${e} - ${l}`)}}}return d}catch(d){const l=r+1;return l>5||nt?{ok:!1,reportError:!1,error:d}:(await ie(Math.pow(2,r)*1e3),Y(e,{...s,retries:l}))}},ot="ul-view-sdk-script",cr=["ios","android"],B="visitors",V="environments";async function x(e,t){var s,o,a;const{shouldDropOnRateLimit:r,...i}=t;i.headers=Object.assign(N(window.UserLeap),i.headers);const n=await Y(e,{...i,shouldDropOnRateLimit:r});if(n.ok){const d=(s=n.headers)==null?void 0:s.get("Authorization"),l=d?d.split(" "):void 0,c=l&&l.length===2?l[1]:void 0,u=(o=n.headers)==null?void 0:o.get("x-ul-visitor-id");if(window.UserLeap.userId&&u===window.UserLeap.visitorId){const y=I.getItemObject("sprig.anon.env.vid.map");y&&y[window.UserLeap.envId]===u&&(delete y[window.UserLeap.envId],I.setItemObject("sprig.anon.env.vid.map",y))}c&&u&&(u!==window.UserLeap.visitorId||window.UserLeap.token!==c)&&(E("token",c),E("vid",u),w.emit(p.VisitorIDUpdated,{visitorId:u}),window.UserLeap.token=c,window.UserLeap.visitorId=u)}return(a=n.json)!=null&&a.logMessage&&console.warn(`[Sprig] ${n.json.logMessage}`),n}function E(e,t){const r=I.getItemObject("userleap.ids");let i=r[window.UserLeap.envId];i?i[e]=t:i={[e]:t},r[window.UserLeap.envId]=i,I.setItemObject("userleap.ids",r)}function Ie(){return window.previewMode?"0":window.UserLeap.visitorId??""}function D(e,t,r){const i=[window.UserLeap._API_URL,"sdk",e];return t&&t.forEach(n=>{i.push(n),n===V?i.push(window.UserLeap.envId):n===B&&i.push(Ie())}),r&&i.push(r),i.join("/")}const J=async(e,t)=>{var Gt,Yt;const{context:r,delay:i,forceBrandedLogo:n,endCard:s,isFeedback:o=!1,heatmap:a,locale:d,previewMode:l,productConfig:c,questions:u,responseGroupUid:y,surveyId:f,uuid:g,vid:k,sessionReplay:C,studyType:_}=e,v=N(window.UserLeap),P=de(v),$=Ee(v);if(C)if(P)w.emit(p.ReplayCapture,{responseGroupUid:y,hasQuestions:!!(u!=null&&u.length),surveyId:f,uploadId:C.uploadId,replayType:C.replayDurationType??"before",seconds:C.replayDurationSeconds,generateVideoUploadUrlPayload:{mediaRecordingUid:Le(),mediaType:"screen",questionId:1,responseGroupUid:y,surveyId:f,updatedAt:new Date().toISOString(),visitorId:window.UserLeap.visitorId,isReplay:!0}});else return window.UserLeap.reportError("displayQuestions",new Error("Replay module not registered")),{success:!1,message:"Replay module not registered",surveyState:"no survey"};if(a)return window.UserLeap.reportError("displayQuestions",new Error("Replay module not registered")),{success:!1,message:"Replay module not registered",surveyState:"no survey"};if(k==null||!(u!=null&&u.length))return U.info("CannotDisplaySurvey",{vid:k}),{success:!1,message:"[Sprig] no survey found",surveyState:"no survey"};if(window.UserLeap.container){U.info("AlreadyDisplayingSurvey");const b="[Sprig] (ERR-409) Found an existing Survey container, aborting rendering of this survey";return console.warn(b),{success:!1,message:b,surveyState:"no survey"}}if(k!==window.UserLeap.visitorId&&g!==window.UserLeap.visitorId&&!window.previewMode){const b="Attempted to display survey to a different visitor";return window.UserLeap.reportError("DisplaySurvey",new Error(b)),{success:!1,message:b,surveyState:"no survey"}}U.info("ShowingSurvey",{surveyId:f}),rr.disable(),w.emit(p.SurveyWillPresent,{name:p.SurveyWillPresent,"survey.id":f});let T,h=document.createElement("div"),K,R,be;const zt=b=>{const{"view.version":En}=b;En!==v["x-ul-sdk-version"]&&dt(),w.removeListener("verify.view.version",zt)};w.on("verify.view.version",zt),window.UserLeap.useMobileStyling=$,ir(v)?(T="ul-direct-embeded-frame",K=document.head,R=window,be=!1,P&&(at(f,o),h.id=T,window.UserLeap.container.appendChild(h),ct(),w.emit(p.SurveyLifeCycle,{state:"presented"}),w.emit(p.SurveyPresented,{name:p.SurveyPresented,"survey.id":f}))):{frameId:T,contentWinDocHead:K,contentWindow:R,hasOverlay:be,iframe:h}=fr({productConfig:c,useMobileStyling:$,surveyId:f,isFeedback:o}),window.UserLeap.frameId=T;const Sn=b=>{w.once(p.CloseSurveyOnOverlayClick,b)},G={apiURL:window.UserLeap._API_URL,cards:u,configureExitOnOverlayClick:Sn,context:r,endCard:s,envId:window.UserLeap.envId,eventEmitFn:w.emit.bind(w),fontFamily:window.UserLeap.fontFamily,fontFamilyURL:window.UserLeap.fontFamilyURL,forceBrandedLogo:n,frame:h,headers:v,locale:d,mobileSDKVersion:window.UserLeap.mobileSDKVersion,previewKey:I.getItem("sprig.previewKey"),previewMode:l,productConfig:{framePosition:c==null?void 0:c.framePosition,desktopDisplay:c==null?void 0:c.desktopDisplay,placement:c==null?void 0:c.placement},responseGroupUid:y,startingQuestionIdx:(Gt=window.UserLeap.config)==null?void 0:Gt.startingQuestionIdx,studyType:_,styleNonce:window.UserLeap.styleNonce,surveyId:f,tabTitle:document.title,trackPageViewUrl:t,ulEvents:ne,upchunkLibraryURL:window.UserLeap.upchunkLibraryURL,useMobileStyling:$,userId:g,viewDocument:R==null?void 0:R.document,viewWindow:R,visitorAttributes:{externalUserId:window.UserLeap.userId,email:window.UserLeap.email},...window.UserLeap._config};(Yt=window.UserLeap._config)!=null&&Yt.startingQuestionIdx&&(window.UserLeap._config={...window.UserLeap._config,startingQuestionIdx:null});const Un=(o?window.UserLeap.feedbackCustomStyles:window.UserLeap.customStyles)??c.customStyles;G.customStyles=Un,R&&(R.__cfg=G);function In(){const b=document.createElement("script");return window.UserLeap.nonce&&b.setAttribute("nonce",window.UserLeap.nonce),b.id=ot,b}const Ke=window.UserLeap.viewSDKURL?window.UserLeap.viewSDKURL:G.path,$t=document.getElementById(ot);$t&&$t.remove();const Ge=In(),qt=()=>{window.UserLeap.container&&Object.assign(window.UserLeap.container.style,{display:"flex"})};if(G.installationMethod==="web-npm"||G.installationMethod==="web-npm-bundled"){const{default:b}=await import("../view/view.tsx");b.configure(G),be&&window.UserLeap.container&&qt()}else Ke&&(Ge.src=Ke,be&&Ge.addEventListener("load",()=>{window.UserLeap.container&&qt()}),R==null||R.addEventListener("error",b=>{b.target instanceof HTMLScriptElement&&b.target.src===Ke&&window.UserLeap.reportError("loadFrameScript",new Error("Frame script failed to load"))},{capture:!0,once:!0}));K==null||K.appendChild(Ge);const Kt={success:!0,surveyState:"ready",surveyId:f,responseGroupUid:y};return window.UserLeap.isMobileSDK&&i&&(Kt.delay=i),Kt};function Ee(e){var r;if(window.UserLeap.useMobileStyling!==void 0)return window.UserLeap.useMobileStyling;const t=((r=window.UserLeap.windowDimensions)==null?void 0:r.width)??document.body.clientWidth;return de(e)||t>10&&t<Zt}function de(e){return cr.includes(e["userleap-platform"])}const ke="ul-frame";window.UserLeap&&window.Sprig&&(window.Sprig._gtm?window.Sprig=window.UserLeap:window.UserLeap=window.Sprig),window.UserLeap||(window.UserLeap=window.Sprig),window.Sprig||(window.Sprig=window.UserLeap);const lr="rgba(255,255,255, 0.95)",ur="rgba(0,0,0,0.9)",_e="0px",at=(e,t,r)=>{window.UserLeap.container=document.createElement("div"),window.UserLeap.container.className=`ul-container${t?" ul-container-feedback":""}`,e&&(window.UserLeap.container.dataset.studyId=e.toString());const i=wt();r&&i&&!window.UserLeap.useMobileStyling?i.appendChild(window.UserLeap.container):document.body.appendChild(window.UserLeap.container)},dt=(e,t)=>{var i;gr();const r=window.UserLeap.container;if(r)try{(i=r.parentNode)==null||i.removeChild(r),window.UserLeap.container=null,E("trackStartUrl",null),w.emit(p.SurveyLifeCycle,{state:"dismissed"}),w.emit(p.SurveyClosed,{name:p.SurveyClosed,initiator:e,"survey.id":parseInt(r.dataset.studyId),...t&&{studyType:t}})}catch(n){console.warn(`[Sprig] (ERR-412) Error removing UserLeap container by ${e} `+r),n instanceof Error&&window.UserLeap.reportError("dismissActiveSurvey",n)}},ct=()=>{w.once(p.SurveyWillClose,({initiator:e,studyType:t})=>{w.removeAllListeners(p.CloseSurveyOnOverlayClick),dt(e,t)})},pr=(e,t)=>{const i={...{position:"fixed",overflow:"auto",top:"0px",left:"0px",display:"none",height:"100%",width:"100%",transition:"background-color 0.3s ease-out",zIndex:2147483646}},n=t?e.overlayStyleMobile:e.overlayStyle;i["background-color"]=n==="light"?lr:ur,t||(i.margin="auto"),window.UserLeap.container&&Object.assign(window.UserLeap.container.style,i)},wr=(e,t,r,i)=>{var c,u;const n={position:"fixed",bottom:"0px",right:_e,border:0,backgroundColor:"rgba(0,0,0,0)",zIndex:2147483646,transition:"width 0.2s ease-in-out, height 0.2s ease-in-out",maxWidth:"100%"},s=Object.assign({},t,window.UserLeap),{desktopDisplay:o}=t||{},a=o==="center-modal";a&&(s.framePosition="center");let d,l=!1;if(r)(c=window.UserLeap.windowDimensions)!=null&&c.width?n.width=`${window.UserLeap.windowDimensions.width}px`:n.width="100%",(u=window.UserLeap.windowDimensions)!=null&&u.height?n.maxHeight=`${window.UserLeap.windowDimensions.height-20}px`:window.UserLeap.maxHeight?n.maxHeight=window.UserLeap.maxHeight:n.maxHeight=`${document.body.clientHeight-20}px`,["light","dark"].includes(s.overlayStyleMobile)&&(l=!0);else{n.width=Xt,n.maxHeight=window.UserLeap.maxHeight||"66vh";const y=()=>{l=!0,d={margin:"auto",position:"static"}};if(i)a?y():d={position:"relative",height:"300px"};else switch(s.framePosition){case"bottomLeft":d={left:_e};break;case"topLeft":d={left:_e,top:0};break;case"topRight":d={top:0};break;case"center":y();break}}return l&&pr(s,r),Object.assign(e.style,n,d),l},fr=({productConfig:e,useMobileStyling:t,surveyId:r,isFeedback:i})=>{var y,f;const n=ke,s=i&&e.desktopDisplay==="slider";at(r,i,s),mr();const o=document.createElement("iframe");o.id=n,o.setAttribute("title","Sprig User Feedback Dialog");const a=wr(o,e,t,i);ct();let d=!1;o.setHeight=g=>{(parseInt(o.style.height)!=g||!d)&&(d=!0,o.style.height=`${g}px`,w.emit(p.SurveyHeight,{name:p.SurveyHeight,contentFrameHeight:g,"survey.id":r}))};let l=!1;o.setWidth=g=>{(parseInt(o.style.width)!=g||!l)&&(l=!0,o.style.width=`${g}px`,w.emit(p.SurveyWidth,{name:p.SurveyWidth,contentFrameWidth:g,"survey.id":r}))},(y=window.UserLeap.container)==null||y.appendChild(o),e&&(t?e.exitOnOverlayClickMobile:e.exitOnOverlayClick)&&window.UserLeap.container&&(window.UserLeap.container.onclick=()=>{w.emit(p.CloseSurveyOnOverlayClick)}),w.emit(p.SurveyLifeCycle,{state:"presented"}),w.emit(p.SurveyPresented,{name:p.SurveyPresented,"survey.id":r});const c=(f=o.contentWindow)==null?void 0:f.document;if(c&&(c.open("text/html","replace"),c.write("<!doctype html><head></head><body></body></html>"),c.close(),!t)){const g=c.body;g.style.display="flex",g.style.alignItems="center"}const u=c==null?void 0:c.head;return{frameId:n,contentWinDocHead:u,contentWindow:o.contentWindow,hasOverlay:a,iframe:o}},lt={[p.SurveyFadingOut]:()=>{window.UserLeap.container&&Object.assign(window.UserLeap.container.style,{"background-color":"rgba(0,0,0,0)"})}},mr=()=>{Object.entries(lt).forEach(([e,t])=>{w.on(e,t)})},gr=()=>{Object.entries(lt).forEach(([e,t])=>{w.off(e,t)})},ut=Object.freeze({contains:(e,t)=>t.includes(e),notContains:(e,t)=>!t.includes(e),exactly:(e,t)=>t===e,notExactly:(e,t)=>t!==e,startsWith:(e,t)=>t.startsWith(e),endsWith:(e,t)=>t.endsWith(e),regex:(e,t)=>new RegExp(e).test(t),legacy:(e,t)=>new RegExp(e,"i").test(t)});function ce(e,t){const{matchType:r,pattern:i}=e,n=r?ut[r]:ut.legacy;let s=!1;try{s=n(i,t)}catch(o){const a=`[Sprig] (ERR-445) Failed to check url match with pattern ${i}`;o instanceof Error&&(console.warn(a,o),o.stack=JSON.stringify(e),window.UserLeap.reportError(a,o))}return s}const yr=e=>{const{pageUrlEvents:t}=window.UserLeap._config,r=t==null?void 0:t.find(i=>i.id===e);return r?ce(r,window.location.href):!1},hr=1,pt=e=>e instanceof HTMLElement||e instanceof SVGElement,le=({document:e,elementId:t,styleString:r,nonce:i})=>{const n=e.getElementById(t);if(n){n.textContent=r;return}const s=e.createElement("style");i&&(s.nonce=i),s.textContent=r,s.id=t,e.head.appendChild(s)},vr=e=>{const t=e.querySelector(".ul-card__container");let r=600,i=360;if(t){r=t.scrollHeight;const n=getComputedStyle(t),s=parseFloat(n.marginTop)+parseFloat(n.marginBottom),o=parseFloat(n.borderTopWidth)+parseFloat(n.borderBottomWidth),a=parseFloat(n.paddingTop)+parseFloat(n.paddingBottom);r+=s+o+a;const d=t.querySelector(".ul-card--matrix_grid");i=d?d.scrollWidth:t.scrollWidth;const l=parseFloat(n.paddingLeft)+parseFloat(n.paddingRight),c=parseFloat(n.marginLeft)+parseFloat(n.marginRight),u=parseFloat(n.borderLeftWidth)+parseFloat(n.borderRightWidth);i+=c+u+l}return[r+hr,i]},wt=()=>m,q=()=>document.getElementById("sprig-feedback-container"),De=()=>document.getElementById("sprig-feedback-loading-animation"),br=()=>{if(De())return;const e=document.createElement("div");return e.className="ul-loading-spinner-container",e.id="sprig-feedback-loading-animation",e.role="progressbar",e.setAttribute("aria-live","polite"),e.setAttribute("aria-busy","true"),e.setAttribute("aria-label","Processing..."),e.innerHTML=`
    <div class="ul-loading-spinner">
      <div class="first"></div>
      <div class="second"></div>
      <div class="third"></div>
      <div class="fourth"></div>
    </div>
  `,e},ft=()=>!!document.getElementById(ke);let mt=!1,m=null,A=null,Re=!1,Q=null,H=null;const Lr=["bottom-left","bottom-right","center-left","center-right"],Sr=e=>{if(q()||!Lr.includes(e))return;const[t,r]=e.split("-"),i=document.createElement("div");i.id="sprig-feedback-container",i.classList.add(`sprig-feedback-container-${r}`,`sprig-feedback-container-${t}`),document.body.appendChild(i)},ue=()=>{var t;const e=window.UserLeap.container;return((t=e==null?void 0:e.parentElement)==null?void 0:t.id)==="sprig-feedback-loading-container"},gt=()=>document.getElementById("sprig-feedback-error-container"),yt=()=>{if(!m)return 0;const e=m==null?void 0:m.clientWidth,t=window.getComputedStyle(m),r=parseInt(t.borderRightWidth||"0"),i=parseInt(t.borderLeftWidth||"0");return e+r+i},pe=e=>{const t=q();t&&(H!=null&&H.endsWith("right")?t.style.right=`${e}px`:H!=null&&H.endsWith("left")&&(t.style.left=`${e}px`))},Oe=()=>{if(m&&(ue()||gt())){w.off(p.SurveyAppeared,X),xe();const e=yt();return pe(-e),!0}return!1},X=()=>{if(!m||!A)return;const e=De();e&&e.remove(),m.style.height="auto",m.style.width="auto",A.disabled=!1,Re=!1},xe=()=>{if(!m)return;if(!De()){const t=br();t&&(m.style.height="300px",m.style.width="360px",m.appendChild(t))}},ht=()=>{!m||!A||(pe(0),A.disabled=!0,Re=!0)},Ur=async e=>{const t=await x(D("1",[B],"startFeedbackStudy"),{body:JSON.stringify({surveyUuid:e}),method:"POST"});return t.ok?t.json:null},vt=async(e,t,r)=>{const{buttonTheme:i,customStyles:n,eventId:s,placement:o,desktopDisplay:a,feedbackLabel:d,surveyUuid:l,surveyId:c}=e;window.UserLeap.feedbackCustomStyles=void 0;let u=q();if(u){if(!t&&s===Q)return;u.remove(),w.off(ne.SURVEY_FADING_OUT,Oe)}Q=s,le({document,elementId:"sprig-feedback-style",styleString:Qt,nonce:window.UserLeap.styleNonce}),le({document,elementId:"ul-custom-style",styleString:n??"",nonce:window.UserLeap.styleNonce}),mt=a==="center-modal",H=o;const[f,g]=o.split("-");Sr(o),u=q(),A=document.createElement("button");const k=document.createElement("div");k.className="sprig-feedback-button-label",k.innerText=d,A.appendChild(k),A.id="sprig-feedback-button",A.classList.add(`sprig-feedback-button-${g}`,`sprig-feedback-button-${f}`,`sprig-feedback-button-${i}`,"fade-in-transition"),w.on(ne.SURVEY_FADING_OUT,Oe),A.addEventListener("click",async()=>{const v=document.getElementById("sprig-feedback-error-container");if(ft()||gt()){if(Oe()){w.emit(p.SurveyWillClose,{name:p.SurveyWillClose,initiator:F.FeedbackClosed,studyType:"feedbackButton","survey.id":c});const h=q();v&&h&&(h.remove(),Q=null,m=null)}return}const P=N(window.UserLeap);if(!Ee(P)&&!Re&&ht(),t){m&&m.classList.add("sprig-feedback-loading-container-previews"),await J(t),X();return}const T=await Ur(l);if(T)w.once(p.SurveyAppeared,X),J({...T,studyType:"feedbackButton"},r);else if(m){const h=Er();m.appendChild(h),X(),m.style.height="300px",m.style.width="360px"}}),u==null||u.appendChild(A),w.emit(p.FeedbackButtonLoaded,{name:p.FeedbackButtonLoaded,"survey.id":c});const{useMobileStyling:C,_config:{border:_}}=window.UserLeap;if(!mt&&!C){const v=document.createElement("div");v.id="sprig-feedback-loading-container",v.className=`sprig-feedback-loading-container sprig-feedback-loading-container-${g}`,v.style.setProperty("--feedback-border",_),m=v,xe(),u==null||u.appendChild(v);const P=yt();pe(-P)}else pe(0);window.UserLeap._config.isOnQuestionsTab&&t&&!ue()&&m&&(ht(),xe(),m&&m.classList.add("sprig-feedback-loading-container-previews"),J(t),X())},Ir=()=>{if(ue())return;const e=q();if(!e)return;yr(Q)||(e.remove(),Q=null,m=null)},Er=()=>{const e=document.createElement("div");e.id="sprig-feedback-error-container",e.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40" fill="none">
  <circle cx="20" cy="20" r="14.5" stroke="#B0B5B7" stroke-width="3"/>
  <path d="M20 12L20 21.6" stroke="#B0B5B7" stroke-width="3" stroke-linecap="round"/>
  <circle cx="19.9984" cy="27.6" r="1.6" fill="#B0B5B7"/>
  </svg>`;const t=document.createElement("h3");return t.className="sprig-feedback-error-text",t.innerText="There was an error while loading the survey",e.appendChild(t),e},kr="!launch_darkly_";class _r{constructor(){S(this,"_ldData",{})}getAllLaunchDarklyVariations(){return this._ldData}setLDFlagsVariations(t){try{return!t||typeof t!="object"||Array.isArray(t)?!1:(Object.keys(this._ldData).forEach(r=>{delete this._ldData[r]}),Object.keys(t).forEach(r=>this._ldData[`${kr}${r}`]=(t[r]??0)+1),!0)}catch(r){return r instanceof Error&&window.UserLeap.reportError("setAllLDFlagsVariations",r),console.warn("[Sprig] An issue had occured when setting LaunchDarkly flags and variations."),!1}}}const Ae=new _r;Object.freeze(Ae);const Dr="!optimizely_experiments_";class Rr{constructor(){S(this,"_optimizelyData",{})}setOptimizelyExperiment(t,r=!0){if(!t||typeof t!="object")return!1;const{experiments:i}=t;try{return r&&Object.keys(this._optimizelyData).map(n=>{delete this._optimizelyData[n]}),i&&i.map(n=>{const{id:s,variation:o}=n,a=this.transformExperimentId(s);o&&typeof o=="string"&&(this._optimizelyData[a]=o)}),!0}catch(n){return n instanceof Error&&window.UserLeap.reportError("setOptimizelyExperiment",n),!1}}getAllOptimizelyExperiments(){return this._optimizelyData}getOptimizelyVariationName(t){return this._optimizelyData[this.transformExperimentId(t)]}transformExperimentId(t){return Dr+t}getAndSetWebOptimizelyExperiments(){var t;try{if(window&&window.optimizely&&typeof window.optimizely.get=="function"){const r=(t=window.optimizely.get("state"))==null?void 0:t.getExperimentStates({isActive:!0});if(r){const i=Object.keys(r).map(n=>{var s,o;return(s=r[n].variation)!=null&&s.name?{id:n,variation:(o=r[n].variation)==null?void 0:o.name}:{id:n,variation:"Original"}});return this.setOptimizelyExperiment({experiments:i},!1),!0}return!1}return!1}catch(r){return r instanceof Error&&window.UserLeap.reportError("getAndSetWebOptimizely",r),!1}}}const we=new Rr;Object.freeze(we);class Or{constructor(t,r){S(this,"paused");S(this,"queue");S(this,"ul");this.ul=t,this.paused=!1,this.queue=[],this.flush(r)}flush(t){const r=t.length;if(r)for(let i=0;i<r;i++)this.push(t[i])}isPaused(){return this.paused}pause(){this.paused=!0}unpause(){this.paused=!1;const t=this.queue.slice();this.empty(),this.flush(t)}push(t){if(this.paused)this.queue.push(t);else if(t instanceof Function)t();else{const r=Array.prototype.slice.call(t,1),i=t[0],n=this.ul[i];n instanceof Function?n.apply(this.ul,r):i&&console.warn("[Sprig] (ERR-100) No valid UserLeap action called",i)}}perform(t){if(this.paused){let r=()=>{};const i=new Promise(function(n){r=function(){n(t())}});return this.queue.push(r),i}else return t()}empty(){this.queue.length=0}}let bt=!0,Lt=!1;const xr=()=>bt=!1,Ar=["sdk_event_queue_latency_seconds","sdk_replay_add_event_batch_seconds","sdk_replay_cleanup_seconds","sdk_replay_compression_seconds","sdk_replay_get_events_between_seconds","sdk_replay_snapshot_seconds","sdk_mutations_nodes_added","sdk_mutations_nodes_removed","sdk_mutations_attributes_changed","sdk_mutations_character_data","sdk_dom_nodes_count","sdk_page_html_characters"];let Z={},Ce;class Cr{constructor(t){S(this,"_values",[]);S(this,"_isWebMetric");this.name=t,this._isWebMetric=Ar.includes(this.name)}report(t){if(bt&&this._values.push({time:Date.now(),value:t}),Lt||!this._isWebMetric)return;const r=this.findExceededThreshold(t);r&&Ce&&Ce(t,r)}collect(){const t=this._values;return this._values=[],t}findExceededThreshold(t){const r=Z[this.name];if(r)return r.find(i=>this.valueExceedsThreshold(t,i))}valueExceedsThreshold(t,r){return r.type==="max"?t>r.value:r.type==="min"?t<r.value:!1}}const Tr=(e,t)=>{Z={},Lt=!1,e==null||e.forEach(r=>{var i;r.metric in Z||(Z[r.metric]=[]),(i=Z[r.metric])==null||i.push(r)}),Ce=t},Te={},W=e=>{const t=new Cr(e);return Te[e]=t,t},Mr=(e,t)=>{let r=Te[e];return r||(r=W(e)),r.report(t)},Pr=async e=>{const t=Object.values(Te).map(r=>({name:r.name,values:r.collect()}));if(t.some(r=>r.values.length))try{await e(JSON.stringify(t))}catch(r){r instanceof Error&&U.error("MetricsErr",{error:{message:r.message,name:r.name}})}},Fr=({reportingIntervalSeconds:e,postMetrics:t})=>{e?setInterval(()=>{Pr(t)},e*1e3):xr()};let St,Ut;const Me=e=>{let t=0,r=e.firstElementChild;for(;r;)t+=Me(r),r.shadowRoot&&(t+=Me(r.shadowRoot)),r=r.nextElementSibling,t++;return t},Br=()=>document.documentElement.innerHTML.length,It=()=>{St.report(Me(document.body)),Ut.report(Br())},Vr=(e=10*1e3)=>{St=W("sdk_dom_nodes_count"),Ut=W("sdk_page_html_characters"),It(),setInterval(It,e)},Pe=(e,t)=>{const r=performance.now();document.hidden?setTimeout(()=>Pe(e,t),e):setTimeout(()=>{const i=performance.now()-r;t.report(i/1e3),setTimeout(()=>Pe(e,t),e)},0)},Wr=(e=1e3)=>{const t=W("sdk_event_queue_latency_seconds");Pe(e,t)};let fe,me,ge,ye,z={},Et;const he=(e,t=1)=>{const{name:r}=e;z[r]=(z[r]||0)+t},kt=e=>{let t=1;return e.childNodes.forEach(r=>{t+=kt(r)}),t},_t=e=>{let t=0;return e.forEach(r=>{t+=kt(r)}),t},jr=e=>{switch(e.type){case"childList":he(fe,_t(e.addedNodes)),he(me,_t(e.removedNodes));return;case"attributes":he(ge);return;case"characterData":he(ye);return}},Nr=e=>e.forEach(jr),Hr=()=>{Et=new MutationObserver(Nr),Et.observe(document,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0})},zr=()=>{fe.report(z[fe.name]||0),me.report(z[me.name]||0),ge.report(z[ge.name]||0),ye.report(z[ye.name]||0),z={}},$r=(e=1*1e3)=>{fe=W("sdk_mutations_nodes_added"),me=W("sdk_mutations_nodes_removed"),ge=W("sdk_mutations_attributes_changed"),ye=W("sdk_mutations_character_data"),Hr(),setInterval(zr,e)},qr=({isWeb:e,reportingIntervalSeconds:t,thresholds:r,postMetrics:i})=>{Tr(r,(n,s)=>{}),Fr({reportingIntervalSeconds:t,postMetrics:i}),e&&(Wr(),Vr(),$r())},Kr={test:"test"},Gr=["popState","pushState","replaceState"];let Fe;const ee="!email",Dt="pageUrl";function Yr(e,t){const{pageUrlEvents:r,interactiveEvents:i,dismissOnPageChange:n}=window.UserLeap._config;if(!n)return!0;const s=[];r&&r.length&&s.push(...r),i&&i.length&&s.push(...i);const o=e&&s.find(a=>a.id===e);return o?ce(o,window.location.href):t===window.location.href}let Be=window.location.href;function te(e){const{pageUrlEvents:t,interactiveEvents:r,dismissOnPageChange:i,platform:n}=window.UserLeap._config;if(n&&n!=="web")return;Be!==window.location.href&&U.navigation("LocationChange",{from:Be,to:window.location.href}),Be=window.location.href;const o=xt().trackStartUrl,a=o?String(o):null;t&&Ct(window.location.href),r&&(Ot(),Jr()),wt()&&Ir(),se.getItem("sprig.isCapturingHeatmap"),!ue()&&i&&a&&a!==window.location.href&&e&&Gr.includes(e.type)&&window.UserLeap("dismissActiveSurvey",F.PageChange)}const Rt={capture:!0},Jr=()=>{const t=window.UserLeap._config.interactiveEvents.filter(i=>ce(i,window.location.href)).map(i=>{const{name:n,properties:s}=i,{selector:o,innerText:a}=s;return o?d=>{if(pt(d.target))try{d.target.closest(o)&&window.UserLeap("track",n)}catch{}return!1}:d=>(pt(d.target)&&d.target.innerText===a&&window.UserLeap("track",n),!1)}),r=i=>t.forEach(n=>n(i));window.UserLeap._config.interactiveEventsHandler=r,window.addEventListener("click",r,Rt)},Ot=()=>{window.UserLeap._config.interactiveEventsHandler&&window.removeEventListener("click",window.UserLeap._config.interactiveEventsHandler,Rt),delete window.UserLeap._config.interactiveEventsHandler};function Qr(){["hashchange","popstate"].forEach(e=>window.addEventListener(e,te,!0))}function Xr(){["hashchange","popstate"].forEach(e=>window.removeEventListener(e,te,!0)),window.UserLeap._config.interactiveEvents&&Ot()}function Zr(e){const t=new URL(D("1",[V],"questions"));return Object.entries(e||{}).forEach(([r,i])=>{i&&t.searchParams.append(r,String(i))}),t.toString()}function xt(){const e=I.getItemObject("userleap.ids");return e&&e[window.UserLeap.envId]||{}}function At(){if(window.previewMode)return;const e=I.getItemObject("sprig.anon.env.vid.map")||{},t=e[window.UserLeap.envId];window.UserLeap.visitorId=t||Le(),U.info("NewVid",{vid:window.UserLeap.visitorId}),E("vid",window.UserLeap.visitorId),t||(e[window.UserLeap.envId]=window.UserLeap.visitorId,I.setItemObject("sprig.anon.env.vid.map",e)),w.emit(p.VisitorIDUpdated,{visitorId:window.UserLeap.visitorId})}function Ct(e,t,r,i){var n,s;try{if(e.endsWith("mock_snippet.html"))return;U.info("PageView",{url:e});const o=window.UserLeap._config.pageUrlEvents;let a=!1;if(o&&o.length)for(let c=0;c<o.length&&(a=ce(o[c],e),!a);c++);if(!a)return;window.UserLeap.debugMode&&console.info("[DEBUG] Sprig trackPageView",e);const d={url:e};i&&(d.trackPageView=!0),window.UserLeap._queue.push(["track",Dt,t,d,r]);const l=(n=document==null?void 0:document.querySelector('meta[name="description"]'))==null?void 0:n.getAttribute("content");(s=Se.replay)==null||s.RecordPageView({...l&&{description:l},url:e,referrer:document.referrer,pageTitle:document.title})}catch(o){o instanceof Error&&(o.stack=e,window.UserLeap.reportError("trackPageView",o)),console.warn("[Sprig] (ERR-428) Failed to track page view",o)}}function en(){const e="Backbone"in window&&window.Backbone&&window.Backbone.history?window.Backbone.history:window.history;"pushState"in e&&(e.pushState=(t=>function(...i){const n=t.apply(this,i),s=new Event("pushState");return window.dispatchEvent(s),te(s),n})(e.pushState)),"replaceState"in e&&(e.replaceState=(t=>function(...i){const n=t.apply(this,i),s=new Event("replaceState");return window.dispatchEvent(s),te(s),n})(e.replaceState)),Qr()}async function Ve(e,t){const r=Ie();e&&!t&&(window.UserLeap._config.mode=Kr.test);const i=N(window.UserLeap),n=Ee(i),s=await x(Zr({desktopDisplay:window.UserLeap._config.desktopDisplay,isMobile:n,previewLanguage:window.UserLeap._config.previewLanguage,surveyid:e==null?void 0:e.surveyId,surveytemplateid:e==null?void 0:e.surveyTemplateId,vid:r}),{shouldDropOnRateLimit:!0});if(!s.ok)return s.reportError&&s.error&&(console.warn("[Sprig] (ERR-414) Failed to request questions from the server",s.error),window.UserLeap.reportError("getQuestions",s.error)),{success:!1,surveyState:"no survey"};if(s.json.delay&&await ie(s.json.delay),s.json.isFeedback){const{feedbackLabel:o,productConfig:a,surveyUuid:d,feedbackCustomStyles:l}=s.json,{buttonTheme:c,placement:u,desktopDisplay:y}=a,f={customStyles:l,buttonTheme:c,desktopDisplay:y,eventId:0,feedbackLabel:o,placement:u,surveyUuid:d,surveyId:e==null?void 0:e.surveyId};vt(f,s.json)}else return J(s.json,Fe)}function tn(e){let t=e.length;for(;t;){const r=Math.floor(Math.random()*t);t-=1;const i=e[t];e[t]=e[r],e[r]=i}}function rn(e){if(!e)return;window.UserLeap._config=e,e.mute&&window.UserLeap._queue.pause();const{interactiveEvents:t,pageUrlEvents:r,dismissOnPageChange:i}=e;t&&tn(t),(t||r||i)&&(en(),te())}async function nn(e,t){var i,n;let r=!0;return t&&((i=e==null?void 0:e.json)!=null&&i.surveyId)&&(window.UserLeap.delayingSurvey=!0,r=await t(e.json.surveyId),window.UserLeap.delayingSurvey=!1,!r)?!1:((n=e==null?void 0:e.json)!=null&&n.delay&&!window.UserLeap.isMobileSDK&&(window.UserLeap.delayingSurvey=!0,await ie(e.json.delay),window.UserLeap.delayingSurvey=!1),r)}const sn=function(e){if(!window.UserLeap)return;const t=async(n={})=>{var v,P,$,T;const{userId:s,anonymousId:o,metadata:a={},properties:d,showSurveyCallback:l}=n;let{eventName:c}=n;if(window.UserLeap.debugMode&&c!==Dt&&console.info("[DEBUG] Sprig track",n),e.mode==="test")return;const u=I.getItem("sprig.previewKey")??void 0;if(e.requireUserIdForTracking&&!window.UserLeap.userId&&!s){const h="[Sprig] - Skipping tracking without userId";return console.warn(h),{success:!1,message:h,surveyState:"no survey"}}if(!c||c.trim().length===0){c=c?String(c):"";const h="[Sprig] - Invalid event name "+c;return console.warn(h),{success:!1,message:h,surveyState:"no survey"}}const y=Fe??window.location.href;if(a.url||(a.url=y),E("trackStartUrl",y),(P=(v=window.UserLeap)==null?void 0:v._config)!=null&&P.optimizelyEnabled){const h=N(window.UserLeap);de(h)||we.getAndSetWebOptimizelyExperiments(),a.optimizelyExperiments=Object.assign({},we.getAllOptimizelyExperiments())}(T=($=window.UserLeap)==null?void 0:$._config)!=null&&T.launchDarklyEnabled&&(a.launchDarklyFlags=Ae.getAllLaunchDarklyVariations()),s&&(window.UserLeap.userId=s),o&&(window.UserLeap.partnerAnonymousId=o),d&&(a.eventProperties=d),U.info("TrackEvent",{eventName:c});const f=window.UserLeap.delayingSurvey||ft()?await x(D("1",[B],"events/batch"),{body:JSON.stringify({events:[{event:c,metadata:a}],previewKey:u}),method:"POST",shouldDropOnRateLimit:!0}):await x(D("1",[B],"events"),{body:JSON.stringify({event:c,metadata:a,previewKey:u}),method:"POST",shouldDropOnRateLimit:!0});if(!f.ok){const h="[Sprig] (ERR-421) Failed to track event";return f.reportError&&(console.warn(h,f.error),f.error&&window.UserLeap.reportError("track",f.error)),{success:!1,message:h,error:f.error,surveyState:"no survey"}}s&&E("uid",s),o&&E("aid",o);const g=f.json;g.invalidPreviewKey&&I.removeItem("sprig.previewKey");const k=a.trackPageView?a.url:void 0;return!!(g!=null&&g.feedbackButton)&&vt(g.feedbackButton,void 0,k),await nn(f,l)?Yr(g.eventId,y)?J(g,k):{success:!1,message:"Study should not be displayed after page navigation",surveyState:"no survey"}:{success:!1,message:"[Sprig] Callback returned false, aborting rendering of survey",surveyState:"no survey"}},r=(n,s)=>{var a;const o=(a=n==null?void 0:n.querySelector(`[id="${ke}"]`))==null?void 0:a.contentDocument;o&&le({document:o,elementId:"ul-custom-style",styleString:s})},i={async displaySurvey(n){return console.warn("[Sprig] displaySurvey should only be used to debug your studies; not intended for production usage."),window.UserLeap("dismissActiveSurvey",F.Override),Ve({surveyId:n},!0)},_previewSurvey(n){window.UserLeap("dismissActiveSurvey",F.Override),Ve({surveyTemplateId:n},!1)},_reviewSurvey(n){window.UserLeap("dismissActiveSurvey",F.Override),Ve({surveyId:n},!1)},previewSurvey(n){i._previewSurvey(n)},reviewSurvey(n){i._reviewSurvey(n)},mute(){window.UserLeap._queue.pause()},unmute(){window.UserLeap._queue.unpause()},setVisitorToken(){console.warn("[Sprig] setVisitorToken is deprecated.")},dismissActiveSurvey(n=F.API){window.UserLeap.container&&w.emit(p.SurveyWillClose,{name:p.SurveyWillClose,initiator:n,"survey.id":parseInt(window.UserLeap.container.dataset.studyId)})},async setAttribute(n,s){if(!n||!s&&s!==0&&s!==!1){const o="[Sprig] - Disregarding empty attribute / value provided";return console.warn(o),{success:!1,message:o}}return this.setAttributes({[n]:s})},async setAttributes(n){if(n==null||Object.keys(n).length===0){const s="[Sprig] - Disregarding empty attributes provided";return console.warn(s),{success:!1,message:s}}return this.identifyAndSetAttributes({attributes:n})},async identifyAndSetAttributes(n){if(window.UserLeap.debugMode&&console.info("[DEBUG] Sprig identifyAndSetAttributes",n),e.mode==="test")return;if(n===null||typeof n!="object"||!(n.userId||n.anonymousId||n.attributes)){const c="[Sprig] - Disregarding empty payload provided";return console.warn(c),{success:!1,message:c}}const{userId:s,anonymousId:o,attributes:a}=n;if(e.requireUserIdForTracking&&!window.UserLeap.userId&&!s){const c="[Sprig] - Skipping tracking without userId";return console.warn(c),{success:!1,message:c}}if(!a&&(!s||window.UserLeap.userId===s)&&(!o||window.UserLeap.partnerAnonymousId===o))return{success:!0};const d={};s&&(d.userId=window.UserLeap.userId=s),o&&(d.partnerAnonymousId=window.UserLeap.partnerAnonymousId=o);let l;return a?(a.email&&!Object.prototype.hasOwnProperty.call(a,ee)&&(a[ee]=a.email,delete a.email),l=await x(D("1",[V,B],"attributes"),{body:JSON.stringify(a),method:"PUT"}),!l.ok&&l.reportError&&(console.warn("[Sprig] (ERR-432) identifyAndSetAttributes failed",l.error),l.error&&window.UserLeap.reportError("identifyAndSetAttributes",l.error))):l=await x(D("1",[V,B]),{body:JSON.stringify(d),method:"PUT"}),a&&a[ee]&&(window.UserLeap.email=a[ee]),l.ok&&(s&&E("uid",s),o&&E("aid",o)),{success:!!l.ok}},async removeAttributes(n){if(window.UserLeap.debugMode&&console.info("[DEBUG] Sprig removeAttributes",n),e.mode==="test")return;if(n==null||n.length===0){const o="[Sprig] - Disregarding empty attributes provided";return console.warn(o),{success:!1,message:o}}if(e.requireUserIdForTracking&&!window.UserLeap.userId){const o="[Sprig] - Skipping tracking without userId";return console.warn(o),{success:!1,message:o}}const s=await x(D("1",[V,B],"attributes"),{body:JSON.stringify({delete:n}),method:"DELETE"});return!s.ok&&s.reportError&&(console.warn("[Sprig] (ERR-433) Remove attributes failed",s.error),s.error&&window.UserLeap.reportError("removeAttributes",s.error)),{success:!!s.ok}},async addSurveyListener(n){w.on(p.SurveyLifeCycle,n)},async removeSurveyListener(n){w.removeListener(p.SurveyLifeCycle,n)},async addListener(n,s){w.on(n,s)},async removeListener(n,s){w.removeListener(n,s)},async removeAllListeners(){w.removeAllListeners()},setPreviewKey(n){!n||typeof n!="string"||I.isStorageAvailable&&n&&I.setItem("sprig.previewKey",n)},async setUserId(n){if(window.UserLeap.debugMode&&console.info("[DEBUG] Sprig setUserId",n),n==null){const a=`[Sprig] - Invalid userId ${n}`;return console.warn(a),{success:!1,message:a}}if(e.mode==="test"||n===window.UserLeap.userId)return;window.UserLeap.userId=n;const s=window.UserLeap.visitorId,o=await x(D("1",[V,B]),{body:JSON.stringify({userId:n}),method:"PUT"});if(!o.ok){o.reportError&&(console.warn("[Sprig] (ERR-420) Failed to set user id",o.error),o.error&&window.UserLeap.reportError("setUserId",o.error));return}window.UserLeap.visitorId,E("uid",n)},async setPartnerAnonymousId(n){if(window.UserLeap.debugMode&&console.info("[DEBUG] Sprig setPartnerAnonymousId",n),n==null){const s=`[Sprig] - Invalid partnerAnonymousId ${n}`;return console.warn(s),{success:!1,message:s}}return window.UserLeap.partnerAnonymousId=n,E("aid",n),{success:!0}},async track(n,s,o={},a=void 0){return t({eventName:n,properties:s,metadata:o,showSurveyCallback:a})},async identifyAndTrack(n){return await t(n)},trackPageView(n,s=void 0,o=void 0,a=!0){Fe=n,Ct(n,s,o,a)},applyFeedbackStyles({button:n="",view:s=""}){window.UserLeap.feedbackCustomStyles=s,document.getElementById("sprig-feedback-style")&&le({document,elementId:"ul-custom-style",styleString:n,nonce:window.UserLeap.styleNonce}),r(document.querySelector(".ul-container-feedback"),s)},applyStyles(n){window.UserLeap.customStyles=n,r(window.UserLeap.container,n)},setWindowDimensions(n,s){var l,c;const o=typeof n=="string"?parseInt(n,10):n,a=typeof s=="string"?parseInt(s,10):s;if(!isNaN(o)&&!isNaN(a)&&(window.UserLeap.windowDimensions={width:o,height:a}),!window.UserLeap.frameId)return;const d=document.getElementById(window.UserLeap.frameId);d&&(window.UserLeap.useMobileStyling&&((l=window.UserLeap.windowDimensions)!=null&&l.width&&(d.style.width=`${window.UserLeap.windowDimensions.width}px`),(c=window.UserLeap.windowDimensions)!=null&&c.height&&(d.style.maxHeight=`${window.UserLeap.windowDimensions.height-20}px`),d.contentDocument&&(d.style.height=String(vr(d.contentDocument)[0])+"px")),w.emit(p.SurveyDimensions,{name:p.SurveyDimensions,contentFrameWidth:d.clientWidth,contentFrameHeight:d.clientHeight,"survey.id":parseInt(window.UserLeap.container.dataset.studyId)}))},logoutUser(){window.UserLeap.debugMode&&console.info("[DEBUG] Sprig logout"),U.info("LogOut",{vid:window.UserLeap.visitorId,userId:window.UserLeap.userId}),window.UserLeap.visitorId=null,window.UserLeap.userId=null,window.UserLeap.partnerAnonymousId=null,window.UserLeap.token=null,window.UserLeap.email=null,I.removeItem("userleap.ids"),window.UserLeap._queue.isPaused()&&window.UserLeap._queue.empty(),At(),window.UserLeap._queue.unpause()},teardown(){Xr(),window.UserLeap("dismissActiveSurvey",F.API),delete window.UserLeap,delete window.Sprig,delete window._Sprig},integrateOptimizely(n,s=!0){var o,a;if(!((a=(o=window.UserLeap)==null?void 0:o._config)!=null&&a.optimizelyEnabled)){console.warn("[SPRIG] Optimizely integration is currently not enabled for your product.");return}try{const d=typeof n=="string"?JSON.parse(n):n;we.setOptimizelyExperiment(d,s)}catch(d){console.warn("[Sprig] Error with integrating Optimizely data"),d instanceof Error&&window.UserLeap.reportError("integrateOptimizely",d)}},integrateOptimizelyClient(n){var o,a;if(!((a=(o=window.UserLeap)==null?void 0:o._config)!=null&&a.optimizelyEnabled)){console.warn("[SPRIG] Optimizely integration is currently not enabled for your product.");return}const s=({experiment:d,variation:l})=>{const c={experiments:[{id:d.id,variation:l.key}]};window.UserLeap("integrateOptimizely",c,!1)};n.notificationCenter.addNotificationListener("ACTIVATE:experiment, user_id,attributes, variation, event",s)},importLaunchDarklyData(n){var s,o;if(!((o=(s=window.UserLeap)==null?void 0:s._config)!=null&&o.launchDarklyEnabled)){console.warn("[SPRIG] LaunchDarkly integration is currently not enabled for your product.");return}Ae.setLDFlagsVariations(n)},setVisitorAttribute(n,s){return console.warn("[Sprig] setVisitorAttribute is deprecated. Please use setAttribute"),i.setAttribute(n,s)},async setEmail(n){return i.setAttribute(ee,n)},async setVisitorEmail(n){return console.warn("[Sprig] setVisitorEmail is deprecated. Please use setEmail"),i.setEmail(n)},async _generateVideoUploadUrl(n){return dn(n)},_reportMetric(n,s){Mr(n,s)},async _completeSessionReplay({surveyId:n,responseGroupUuid:s,eventDigest:o}){return window.UserLeap.reportError("_completeSessionReplay",new Error("Replay module not registered")),!1}};Object.assign(window.UserLeap,i)};async function on(e){var s,o;const t=N(window.UserLeap);document.addEventListener("securitypolicyviolation",it);const r=await Y(D("1",[V],"config"),{headers:t});if(document.removeEventListener("securitypolicyviolation",it),!r.ok)return(s=window.SprigLoggerCallback)==null||s.call(window,"Sprig config fetch failed"),r.reportError&&(console.warn("[Sprig] (ERR-422) Failed to load configuration",r.error),r.error&&window.UserLeap.reportError("applyRemoteConfig",r.error)),Ue("Disabled: failed to fetch configuration"),e;const i=r.json;return i!=null&&i.disabled?((o=window.SprigLoggerCallback)==null||o.call(window,"Sprig config fetch disabled"),Ue(`Disabled: ${i.disabled}`),{disabled:i.disabled}):Object.assign({},i,e)}async function an(e,t,r={},i={}){const n=window.__cfg&&window.__cfg.mode,s=Ie(),o=window.UserLeap.envId,a=window.document.documentElement,d={mode:n,screenWidth:window.screen.width,screenHeight:window.screen.height,clientWidth:a.clientWidth,clientHeight:a.clientHeight,location:window.location.href,language:window.navigator.language,...r},l={action:e,breadcrumbs:U.breadcrumbs,err:{message:`${t==null?void 0:t.name} - ${t==null?void 0:t.message}`,stack:t==null?void 0:t.stack},meta:d,vid:s,envId:o,...i};(await x(D("1",null,"errors"),{method:"POST",headers:{"x-ul-error":window.btoa(`userleap-${Date.now()}-error`)},body:JSON.stringify(l),shouldDropOnRateLimit:!0})).ok||console.warn("[Sprig] (ERR-444) Failed to report error to API",t)}async function dn(e){var r;if(!e)return;const t=`${window.UserLeap._API_URL}/2/environments/integrations/upload`;try{const i=await fetch(t,{method:"POST",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(i.ok){const n=await i.json();return(r=n==null?void 0:n.upload)==null?void 0:r.url}else return null}catch(i){console.warn("[Sprig] Error with generating video upload url"),i instanceof Error&&window.UserLeap.reportError("generateVideoUploadUrl",i)}}function cn(e={}){var i;(i=window.SprigLoggerCallback)==null||i.call(window,"Initializing Sprig");const t=new URLSearchParams(window.location.search).get("sprigPreviewKey")??"";window.UserLeap.UPDATES=ne,window.UserLeap("setPreviewKey",t);async function r(){var y,f,g,k,C;if(window.UserLeap.loaded)return;if((y=window.SprigLoggerCallback)==null||y.call(window,"Loading Sprig"),window.UserLeap.reportError=an,window.UserLeap.loaded=!0,window.UserLeap._config=Object.assign({},e,window.UserLeap.config),window.UserLeap.delayingSurvey=!1,window.UserLeap._config&&typeof window.UserLeap._config=="object")for(const _ in window.UserLeap._config)window.UserLeap[_]=window.UserLeap._config[_];if(!window.UserLeap.envId)if(window.UserLeap.appId)window.UserLeap.envId=window.UserLeap.appId;else throw new Error("Missing Environment id");window.UserLeap.debugMode&&console.info("[DEBUG] Sprig debug mode enabled");const n=xt(),s=window.UserLeap.sampleRate;let o=n.sampled;if(s){if(o===null&&(o=Math.random()<s,E("sampled",o)),!o)return}else o!==null&&E("sampled",null);window.UserLeap._API_URL||(window.UserLeap._API_URL="https://api.sprig.com");const a=[...window.UserLeap._queue];window.UserLeap._queue=new Or(window.UserLeap,[]),window.UserLeap._queue.pause();for(let _=0;_<a.length;_++)window.UserLeap._queue.push(a[_]);const d=n.token;d?(window.UserLeap.token=d,window.UserLeap.visitorId=n.vid??null,window.UserLeap.userId=n.uid??null,window.UserLeap.partnerAnonymousId=n.aid??null):At();const l=N(window.UserLeap),c=de(l);(f=window.SprigLoggerCallback)==null||f.call(window,"Sprig fetching config");const u=await on(e);(g=window.SprigLoggerCallback)==null||g.call(window,"Sprig fetched config"),qr({isWeb:!c,reportingIntervalSeconds:u.metricsReportingEnabled||u.mobileMetricsReportingEnabled?u.metricsReportingIntervalSeconds:0,thresholds:u.metricThresholds,postMetrics:async _=>{var v;await x(D("1",[V],"metrics"),{body:_,method:"POST",headers:{"x-ul-replay-enabled":`${!!((v=Se.replay)!=null&&v.isReplayRecording())}`},shouldDropOnRateLimit:!0})}}),await((k=Se.replay)==null?void 0:k.initializeReplay({maxReplayDurationSeconds:u.maxReplayDurationSeconds,maxInflightRequests:window.UserLeap.maxInflightReplayRequests??2,replaySettings:u.replaySettings})),sn(u),await rn(u),window.UserLeap._queue.unpause(),(C=window.SprigLoggerCallback)==null||C.call(window,"SdkReady"),w.emit(p.SDKReady,{mobileMetricsReportingEnabled:!!u.mobileMetricsReportingEnabled,metricsReportingInterval:u.metricsReportingIntervalSeconds||0,metricsThresholds:u.metricThresholds||[],maxMobileReplayDurationSeconds:u.maxMobileReplayDurationSeconds,mobileReplaySettings:u.mobileReplaySettings}),w.emit(p.VisitorIDUpdated,{visitorId:window.UserLeap.visitorId})}document.readyState==="complete"?r():window.attachEvent?window.attachEvent("onload",r):window.addEventListener("load",()=>{r()},!1)}const We=(e,t)=>t.some(r=>e instanceof r);let Tt,Mt;function ln(){return Tt||(Tt=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function un(){return Mt||(Mt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const je=new WeakMap,Ne=new WeakMap,ve=new WeakMap;function pn(e){const t=new Promise((r,i)=>{const n=()=>{r(re(e.result))},s=()=>{i(e.error)};e.onsuccess=n,e.onerror=s});return ve.set(t,e),t}function wn(e){if(je.has(e))return;const t=new Promise((r,i)=>{const n=()=>{r()},s=()=>{i(e.error||new DOMException("AbortError","AbortError"))};e.oncomplete=n,e.onerror=s,e.onabort=s});je.set(e,t)}let He={get(e,t,r){if(e instanceof IDBTransaction){if(t==="done")return je.get(e);if(t==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return re(e[t])},set(e,t,r){return e[t]=r,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function Pt(e){He=e(He)}function fn(e){return un().includes(e)?function(...t){return e.apply(ze(this),t),re(this.request)}:function(...t){return re(e.apply(ze(this),t))}}function mn(e){return typeof e=="function"?fn(e):(e instanceof IDBTransaction&&wn(e),We(e,ln())?new Proxy(e,He):e)}function re(e){if(e instanceof IDBRequest)return pn(e);if(Ne.has(e))return Ne.get(e);const t=mn(e);return t!==e&&(Ne.set(e,t),ve.set(t,e)),t}const ze=e=>ve.get(e);function Ft(e,{blocked:t}={}){const r=indexedDB.deleteDatabase(e);return t&&(r.onblocked=i=>t(i.oldVersion,i)),re(r).then(()=>{})}const gn=["get","getKey","getAll","getAllKeys","count"],yn=["put","add","delete","clear"],$e=new Map;function Bt(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if($e.get(t))return $e.get(t);const r=t.replace(/FromIndex$/,""),i=t!==r,n=yn.includes(r);if(!(r in(i?IDBIndex:IDBObjectStore).prototype)||!(n||gn.includes(r)))return;const s=async function(o,...a){const d=this.transaction(o,n?"readwrite":"readonly");let l=d.store;return i&&(l=l.index(a.shift())),(await Promise.all([l[r](...a),n&&d.done]))[0]};return $e.set(t,s),s}Pt(e=>({...e,get:(t,r,i)=>Bt(t,r)||e.get(t,r,i),has:(t,r)=>!!Bt(t,r)||e.has(t,r)}));const hn=["continue","continuePrimaryKey","advance"],Vt={},qe=new WeakMap,Wt=new WeakMap,vn={get(e,t){if(!hn.includes(t))return e[t];let r=Vt[t];return r||(r=Vt[t]=function(...i){qe.set(this,Wt.get(this)[t](...i))}),r}};async function*bn(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const r=new Proxy(t,vn);for(Wt.set(r,t),ve.set(r,ze(t));t;)yield r,t=await(qe.get(r)||t.continue()),qe.delete(r)}function jt(e,t){return t===Symbol.asyncIterator&&We(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&We(e,[IDBIndex,IDBObjectStore])}Pt(e=>({...e,get(t,r,i){return jt(t,r)?bn:e.get(t,r,i)},has(t,r){return jt(t,r)||e.has(t,r)}}));const Nt=(()=>{const e=se.getItem("sprig.sessionId");if(e)return U.info("SessionIDFound",{savedSessionId:e}),se.removeItem("sprig.sessionId"),e;const t=Le();return U.info("GeneratedSessionID",{uuid:t}),t})();window.addEventListener("beforeunload",()=>{U.info("BeforeUnload",{sessionId:Nt}),se.setItem("sprig.sessionId",Nt)}),Ft("replayStorage").catch(console.error),Ft("sprig.replay").catch(console.error);const Ln="sprig-web-view-sdk";let Ht;Ht={path:`https://cdn.sprig.com/${Ln}-v2.32.2.js`},cn(Ht)})();
